{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="max-w-5xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4">Cart from Shop: {{ cart.shop.name }}</h2>
    <a href="{% url 'cart_list' %}" class="text-blue-600 hover:underline mb-4 inline-block">← Back to Cart List</a>

    <h2 class="text-3xl font-bold mb-6">🛒 Your Cart</h2>

    {% if cart_items %}
      <div class="overflow-x-auto rounded-lg shadow">
        <table class="min-w-full bg-white border border-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Product</th>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Quantity</th>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Shop</th>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Price</th>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Stock</th>
              <th class="py-3 px-4 text-left text-sm font-medium text-gray-600">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            {% for item in cart_items %}
                <tr class="hover:bg-gray-50">

                  
                  <td class="py-3 px-4 text-sm text-gray-800 font-semibold">{{ item.product.name }}</td>
                  <td class="py-3 px-4">
                    <input type="number" id="quantity_{{ item.product.id }}"
                      value="{{ item.quantity }}"
                      min="1"
                      max="{{item.product.stock}}"
                      {% if item.product.stock == 0 %}disabled{% endif %}
                      class="w-16 border px-2 py-1 rounded"
                      onchange="addToCart({{ item.product.id }}, parseInt(this.value), true)"
                      >
                      {% if item.quantity > item.product.stock %}
                          <p class="text-red-600 text-sm mt-1">
                              ⚠ Only {{ item.product.stock }} left in stock!
                          </p>
                      {% endif %}
                  </td>
                  <td class="py-3 px-4 text-sm text-gray-700">{{ item.product.shop.name }}</td>
                  <td class="py-3 px-4 text-sm text-green-600 font-bold">₹{{ item.product.price }}</td>
                  {% if item.product.stock == 0 or item.quantity > item.product.stock%}
                    <td><p class="text-red-600 text-sm mt-1 font-semibold">Out of Stock</p></td>
                  {% else %}
                    <td><p class="text-green-600 text-sm mt-1 font-semibold">In Stock</p></td>
                  {% endif %}
                  <td class="py-3 px-4">
                    <button onclick="removeFromCart({{ item.product.id }})"
                            class="text-red-600 font-semibold hover:underline">
                        Remove
                    </button>
                </td>
                </tr>
                <!-- Hidden input to collect product_ids -->
                <input type="hidden" class="product-id" value="{{ item.product.id }}">
            {% endfor %}
        </tbody>

        </table>
      </div>
      
      <div class="mt-8 bg-gray-100 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-2">📍 Select Delivery Address</h3>

        {% if addresses %}
          <select id="addressSelect" class="w-full p-2 border rounded-md">
            {% for address in addresses %}
              <option value="{{ address.id }}">
                {{ address.name }}, {{ address.state }} - {{ address.pincode }}
              </option>
            {% endfor %}
          </select>
        {% else %}
          <div class="text-red-600 mb-2">⚠️ No address found. Please add one.</div>
          <a href="{% url 'add_address' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-block">➕ Add Address</a>
        {% endif %}
      </div>


      <div class="mt-6 flex justify-between">
        <button onclick="placeOrder('{{ cart_items.0.cart.id }}')" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-200">✅ Place Order</button>
        <button onclick="clearCart('{{ cart_items.0.cart.id }}')" 
                class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-200">
            🗑️ Clear Cart
        </button>

      </div>
    {% comment %} {% else %}
      <div class="text-center text-gray-500 text-lg font-medium mt-12">🛍️ Your cart is currently empty.</div> {% endcomment %}
    {% endif %}
    <div id="empty-cart-msg" class="text-center text-gray-500 text-lg font-medium mt-12 {% if cart_items %}hidden{% endif %}">
        🛍️ Your cart is currently empty.
    </div>
  </div>
{% endblock %}
{% block scripts %}
  <script src="{% static 'js/cart.js' %}"></script>
{% endblock %}
