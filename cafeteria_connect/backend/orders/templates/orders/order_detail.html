{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="max-w-4xl mx-auto mt-10 p-6 bg-white shadow-md rounded-xl">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Order #{{ order.id }}</h2>

    <!-- Status Badge for JS updates -->
    <div class="text-right mb-6">
        <span id="order-status-span" class="px-3 py-1 text-sm rounded-full
            {% if order.status == 'pending' %}
                bg-yellow-100 text-yellow-800
            {% elif order.status == 'confirmed' %}
                bg-green-100 text-green-800
            {% elif order.status == 'cancelled' %}
                bg-red-100 text-red-800
            {% elif order.status == 'preparing' %}
                bg-blue-100 text-blue-800
            {% else %}
                bg-gray-100 text-gray-800
            {% endif %}
        ">
            {{ order.get_status_display }}
        </span>
    </div>

    <!-- Order Meta Info -->
    <div class="mb-4 text-sm text-gray-600">
        <p>Shop: <strong>{{ order.shop.name }}</strong> ({{ order.shop.contact }})</p>
        <p>Placed on: {{ order.created_at|date:"d M Y, h:i A" }}</p>
        {% if order.address %}
            <p>Delivery Address: {{ order.address.line1 }}, {{ order.address.city }} - {{ order.address.pincode }}</p>
        {% endif %}
    </div>

    <!-- Progress Bar Clickable -->
   <div class="flex items-center justify-between mb-8">
    {% for value, label in order.STATUS_CHOICES %}
        <div class="flex flex-col items-center w-full relative">
            <div 
                id="progress-step-{{ value }}"
                data-status="{{ value }}"
                class="w-8 h-8 flex items-center justify-center rounded-full cursor-pointer transition-colors duration-300
                    {% if order.status == value %}
                        bg-blue-600 text-white
                    {% elif forloop.counter0 < current_index %}
                        bg-green-500 text-white
                    {% else %}
                        bg-gray-300 text-gray-600
                    {% endif %}
                "
                onclick="updateStatus('{{ value }}', {{ forloop.counter0 }}, {{ current_index }}, {{ order.id }})"
                title="{{ label }}"
            >
                {{ forloop.counter }}
            </div>
            <p class="text-xs mt-1 text-center">{{ label }}</p>

            {% if not forloop.last %}
                <!-- Line between steps -->
                <div class="absolute top-4 left-full w-full h-1 bg-gray-300 z-0" style="width: calc(100% + 0.5rem);"></div>
            {% endif %}
        </div>
    {% endfor %}
</div>


    <!-- Order Items -->
    <div class="mb-6">
        <h3 class="font-semibold text-gray-700 mb-2">Items</h3>
        <ul class="list-disc pl-5">
            {% for item in order.items.all %}
                <li>{{ item.quantity }} × {{ item.product.name }} — ₹{{ item.product.price }}</li>
            {% endfor %}
        </ul>
    </div>

    <p class="font-bold text-gray-800">Total: ₹{{ order.total_price }}</p>
</div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/cart.js' %}"></script>
    <script>
        window.CURRENT_ORDER_ID = {{ order.id }};
        window.VISIBLE_ORDER_IDS = []; // No list page here
        window.CURRENT_USER_ID = {{ request.user.id }};

    </script>
    <script src="{% static 'js/notifications.js' %}"></script>
{% endblock %}
